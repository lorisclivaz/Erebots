{"version":3,"sources":["view/protected/pages/Questions/Question.js"],"names":["Question","props","questionDataField","fieldNames","formID","state","createPartialInitialStateFromFields","objID","QUESTION_TEXT_EN_FIELD_NAME","QUESTION_TEXT_IT_FIELD_NAME","QUESTION_TEXT_FR_FIELD_NAME","QUESTION_TEXT_DE_FIELD_NAME","QUESTION_NEXT_FIELD_NAME","QUESTION_PREVIOUS_FIELD_NAME","setCurrentStateFromData","bind","getCurrentID","handleTextChange","sendChangesToServer","setErrorMessage","toggleDeletionModal","deleteCurrentFromServer","isHandlingNewObject","load","getSingle","serverEndPoint","SERVER_QUESTION_ENDPOINT","id","data","this","setState","QUESTION_ID_FIELD_NAME","OBJECT_REFERENCE_ID_FIELD_NAME","match","params","field","changedText","changedState","errorMessage","uploadingChanges","window","scrollTo","insertNew","log","formData","FormData","document","getElementById","append","get","serverPromise","postObject","ACTION_CREATE","formDataObject","toUpdateID","ACTION_MODIFY","then","result","debug","history","back","error","warn","message","deletionModalOpen","ACTION_DELETE","className","lg","errorComponent","color","onClick","isOpen","toggle","formComponent","action","method","encType","map","keyHandler","getKeyHandlerFor","QUESTION_FIELD_NAME_TO_PRETTY_DESCRIPTION_FUNCTION","row","key","md","htmlFor","keyPrettyNameLong","xs","type","rows","name","placeholder","value","onChange","e","target","disabled","alt","src","require","to","showLoadingOrRender","_","createLoading","Component"],"mappings":"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","file":"static/js/67.d4b21f32.chunk.js","sourcesContent":["import React, {Component} from 'react';\r\nimport {\r\n  Button,\r\n  Card,\r\n  CardBody,\r\n  CardHeader,\r\n  Col,\r\n  Form,\r\n  FormGroup,\r\n  Input,\r\n  Label,\r\n  Modal,\r\n  ModalBody,\r\n  ModalFooter,\r\n  ModalHeader,\r\n  Row\r\n} from 'reactstrap';\r\nimport {\r\n  ACTION_CREATE,\r\n  ACTION_DELETE,\r\n  ACTION_MODIFY,\r\n  getSingle,\r\n  postObject,\r\n  SERVER_QUESTION_ENDPOINT\r\n} from \"../../../../controller/ServerApi\";\r\nimport {\r\n  createLoading,\r\n  createPartialInitialStateFromFields,\r\n  errorComponent,\r\n  load,\r\n  showLoadingOrRender\r\n} from \"../../../../utils/DataLoadingUtils\";\r\nimport {OBJECT_REFERENCE_ID_FIELD_NAME} from \"../../../../model/ModelUtils\";\r\nimport {getKeyHandlerFor} from \"../../../../model/FieldPrettifyHandler\";\r\nimport {Link} from \"react-router-dom\";\r\nimport {debug, log, warn} from \"../../../../utils/Logging\";\r\nimport './Question.css'\r\nimport {\r\n  QUESTION_FIELD_NAME_TO_PRETTY_DESCRIPTION_FUNCTION,\r\n  QUESTION_ID_FIELD_NAME,\r\n  QUESTION_NEXT_FIELD_NAME,\r\n  QUESTION_PREVIOUS_FIELD_NAME,\r\n  QUESTION_TEXT_DE_FIELD_NAME,\r\n  QUESTION_TEXT_EN_FIELD_NAME,\r\n  QUESTION_TEXT_FR_FIELD_NAME,\r\n  QUESTION_TEXT_IT_FIELD_NAME\r\n} from \"../../../../model/QuestionFieldNamesDictionaryToDescription\";\r\n\r\nconst currentScriptName = \"Question.js\";\r\n\r\nclass Question extends Component {\r\n\r\n  questionDataField = \"questionData\";\r\n\r\n  fieldNames = [\r\n    this.questionDataField,\r\n  ];\r\n\r\n  formID = \"question-form\"\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      ...(createPartialInitialStateFromFields(this.fieldNames)),\r\n      objID: '',\r\n      [QUESTION_TEXT_EN_FIELD_NAME]: '',\r\n      [QUESTION_TEXT_IT_FIELD_NAME]: '',\r\n      [QUESTION_TEXT_FR_FIELD_NAME]: '',\r\n      [QUESTION_TEXT_DE_FIELD_NAME]: '',\r\n      [QUESTION_NEXT_FIELD_NAME]: '',\r\n      [QUESTION_PREVIOUS_FIELD_NAME]: '',\r\n      uploadingChanges: false,\r\n      errorMessage: '',\r\n      deletionModalOpen: false,\r\n    };\r\n\r\n    this.setCurrentStateFromData.bind(this);\r\n    this.getCurrentID.bind(this);\r\n    this.handleTextChange.bind(this);\r\n    this.sendChangesToServer.bind(this);\r\n    this.setErrorMessage.bind(this);\r\n    this.toggleDeletionModal.bind(this);\r\n    this.deleteCurrentFromServer.bind(this);\r\n\r\n    if (!this.isHandlingNewObject()) {\r\n      load(this, this.questionDataField, getSingle,\r\n        {serverEndPoint: SERVER_QUESTION_ENDPOINT, id: this.getCurrentID()},\r\n        (data) => this.setCurrentStateFromData(data)\r\n      );\r\n    }\r\n  }\r\n\r\n  setCurrentStateFromData(data) {\r\n    this.setState({\r\n      objID: data[QUESTION_ID_FIELD_NAME][OBJECT_REFERENCE_ID_FIELD_NAME],\r\n      [QUESTION_TEXT_EN_FIELD_NAME]: data[QUESTION_TEXT_EN_FIELD_NAME],\r\n      [QUESTION_TEXT_IT_FIELD_NAME]: data[QUESTION_TEXT_IT_FIELD_NAME] || '',\r\n      [QUESTION_TEXT_FR_FIELD_NAME]: data[QUESTION_TEXT_FR_FIELD_NAME] || '',\r\n      [QUESTION_TEXT_DE_FIELD_NAME]: data[QUESTION_TEXT_DE_FIELD_NAME] || '',\r\n      [QUESTION_NEXT_FIELD_NAME]: data[QUESTION_NEXT_FIELD_NAME]\r\n        ? data[QUESTION_NEXT_FIELD_NAME][OBJECT_REFERENCE_ID_FIELD_NAME] : '',\r\n\r\n      [QUESTION_PREVIOUS_FIELD_NAME]: data[QUESTION_PREVIOUS_FIELD_NAME]\r\n        ? data[QUESTION_PREVIOUS_FIELD_NAME][OBJECT_REFERENCE_ID_FIELD_NAME] : ''\r\n    })\r\n  }\r\n\r\n  getCurrentID() {\r\n    return this.props.match.params.id\r\n  }\r\n\r\n  isHandlingNewObject() {\r\n    return this.getCurrentID() === \"new\"\r\n  }\r\n\r\n  handleTextChange(field, changedText) {\r\n    const changedState = {}\r\n    changedState[field] = changedText\r\n    this.setState(changedState)\r\n  }\r\n\r\n  setErrorMessage(errorMessage) {\r\n    this.setState({\r\n      uploadingChanges: false,\r\n      errorMessage: errorMessage\r\n    })\r\n    window.scrollTo(0, 0)\r\n  }\r\n\r\n  sendChangesToServer(insertNew = false) {\r\n    log(currentScriptName, `Called sendChangesToServer with insertNew=${insertNew}`);\r\n    this.setState({\r\n      uploadingChanges: true,\r\n      errorMessage: ''\r\n    })\r\n\r\n    const formData = new FormData(document.getElementById(this.formID))\r\n    formData.append(QUESTION_NEXT_FIELD_NAME, this.state[QUESTION_NEXT_FIELD_NAME])\r\n    formData.append(QUESTION_PREVIOUS_FIELD_NAME, this.state[QUESTION_PREVIOUS_FIELD_NAME])\r\n    if (!formData.get(QUESTION_TEXT_EN_FIELD_NAME)) {\r\n      this.setErrorMessage('English description is mandatory!')\r\n    } else {\r\n      let serverPromise\r\n      if (insertNew) {\r\n        serverPromise = postObject(ACTION_CREATE, SERVER_QUESTION_ENDPOINT, {formDataObject: formData})\r\n      } else {\r\n        const toUpdateID = this.getCurrentID()\r\n        serverPromise = postObject(ACTION_MODIFY, SERVER_QUESTION_ENDPOINT, {id: toUpdateID, formDataObject: formData})\r\n      }\r\n\r\n      serverPromise.then(\r\n        (result) => {\r\n          debug(currentScriptName, `Saved changes to server:`, result);\r\n          this.setCurrentStateFromData(result)\r\n          this.setState({uploadingChanges: false})\r\n\r\n          // Go to list of objects, when done\r\n          window.history.back()\r\n        },\r\n        (error) => {\r\n          warn(currentScriptName, `Error from server saving changes:`, error.message);\r\n          this.setErrorMessage(error.message)\r\n        }\r\n      )\r\n    }\r\n  }\r\n\r\n  toggleDeletionModal() {\r\n    this.setState({deletionModalOpen: !this.state.deletionModalOpen})\r\n  }\r\n\r\n  deleteCurrentFromServer() {\r\n    postObject(ACTION_DELETE, SERVER_QUESTION_ENDPOINT, {id: this.getCurrentID()}).then(\r\n      result => {\r\n        debug(currentScriptName, `Deleted from server:`, result);\r\n        this.setState({uploadingChanges: false})\r\n\r\n        // Go to list of objects, when done\r\n        window.history.back()\r\n      },\r\n      error => {\r\n        warn(currentScriptName, `Error from server during deletion:`, error.message);\r\n        this.setErrorMessage(error.message)\r\n      }\r\n    )\r\n\r\n    this.toggleDeletionModal()\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"animated fadeIn\">\r\n        <Row>\r\n          <Col lg={12}>\r\n            {this.state.errorMessage === '' ? null : errorComponent(this.state.errorMessage)}\r\n            <Card>\r\n              <CardHeader>\r\n                <strong>\r\n                  <i className=\"icon-info pr-1\"/>\r\n                  {\r\n                    this.isHandlingNewObject() ? 'New Question' : `Question ID: ${this.state.objID}`\r\n                  }\r\n                </strong>\r\n                {\r\n                  this.isHandlingNewObject()\r\n                    ? null\r\n                    : <Button color=\"danger\"\r\n                              onClick={this.toggleDeletionModal.bind(this)}\r\n                              className=\"mr-1 float-right\">\r\n                      <i className={\"fa fa-trash\"}/> Delete\r\n                    </Button>\r\n                }\r\n                <Modal isOpen={this.state.deletionModalOpen} toggle={this.toggleDeletionModal.bind(this)}\r\n                       className={'modal-danger'}>\r\n                  <ModalHeader toggle={this.toggleDeletionModal.bind(this)}>Delete Question</ModalHeader>\r\n                  <ModalBody>\r\n                    This will permanently delete the current Question from database.\r\n                    <br/>\r\n                    <br/>\r\n                    References to this Question will be removed from every data structure in which it is.\r\n                    This means that every Exercise Set Mapping of this question will be also deleted and\r\n                    all users at this question level will not have a level anymore. Consider modifying questions\r\n                    instead of deleting and inserting them again.\r\n                  </ModalBody>\r\n                  <ModalFooter>\r\n                    <Button color=\"danger\" onClick={this.deleteCurrentFromServer.bind(this)}>Delete</Button>{' '}\r\n                    <Button color=\"secondary\" onClick={this.toggleDeletionModal.bind(this)}>Cancel</Button>\r\n                  </ModalFooter>\r\n                </Modal>\r\n              </CardHeader>\r\n              <CardBody>\r\n                {(() => {\r\n                  const formComponent = (\r\n                    <div>\r\n                      <Form id={this.formID} action=\"\" method=\"post\" encType=\"multipart/form-data\"\r\n                            className=\"form-horizontal\">\r\n                        {\r\n                          [\r\n                            QUESTION_TEXT_EN_FIELD_NAME,\r\n                            QUESTION_TEXT_IT_FIELD_NAME,\r\n                            QUESTION_TEXT_FR_FIELD_NAME,\r\n                            QUESTION_TEXT_DE_FIELD_NAME,\r\n                          ].map(field => {\r\n                            const keyHandler = getKeyHandlerFor(field, QUESTION_FIELD_NAME_TO_PRETTY_DESCRIPTION_FUNCTION)\r\n                            return (\r\n                              <FormGroup row key={field}>\r\n                                <Col md=\"2\">\r\n                                  <Label htmlFor={`textarea-input-${field}`}>{keyHandler.keyPrettyNameLong}</Label>\r\n                                </Col>\r\n                                <Col xs=\"12\" md=\"10\">\r\n                                  <Input type=\"textarea\" rows=\"2\"\r\n                                         name={field}\r\n                                         id={`textarea-input-${field}`}\r\n                                         placeholder={`${keyHandler.keyPrettyNameLong} ...`}\r\n                                         value={this.state[field]}\r\n                                         onChange={e => this.handleTextChange(field, e.target.value)}\r\n                                  />\r\n                                </Col>\r\n                              </FormGroup>\r\n                            )\r\n                          })\r\n                        }\r\n                      </Form>\r\n                      <div className=\"form-actions float-right\">\r\n                        <Button type=\"submit\" color=\"primary\" className={\"mr-2\"}\r\n                                onClick={() => this.sendChangesToServer(this.isHandlingNewObject())}\r\n                                disabled={this.state.uploadingChanges}\r\n                        >\r\n                          {this.state.uploadingChanges\r\n                            ? <img className='spinner' alt=\"spinner\"\r\n                                   src={require('../../../../assets/img/spinner.gif')}/>\r\n                            : null}\r\n                          {this.isHandlingNewObject() ? 'Insert' : 'Save changes'}\r\n                        </Button>\r\n                        <Link to={\"/home/modify/questions\"}>\r\n                          <Button color=\"secondary\" disabled={this.state.uploadingChanges}>Cancel</Button>\r\n                        </Link>\r\n                      </div>\r\n                    </div>\r\n                  )\r\n\r\n                  // To show a loading if fields are not ready to be filled with server data\r\n                  return this.isHandlingNewObject() ? formComponent : showLoadingOrRender(\r\n                    this, this.questionDataField, _ => formComponent, createLoading({})\r\n                  )\r\n                })()}\r\n              </CardBody>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Question;\r\n"],"sourceRoot":""}